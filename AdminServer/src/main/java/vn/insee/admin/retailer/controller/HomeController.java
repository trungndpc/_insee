package vn.insee.admin.retailer.controller;

import com.fasterxml.jackson.databind.ObjectMapper;
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.MediaType;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.bind.annotation.RestController;
import vn.insee.admin.retailer.controller.converter.UserConverter;
import vn.insee.admin.retailer.service.UserService;
import vn.insee.admin.retailer.util.ReadFileExcelUtil;
import vn.insee.admin.retailer.util.RenderUtils;
import vn.insee.admin.retailer.woker.Scheduler;
import vn.insee.common.Permission;
import vn.insee.common.status.StatusUser;
import vn.insee.jpa.entity.UserEntity;
import vn.insee.jpa.repository.UserRepository;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.List;
import java.util.stream.Collectors;


@RestController
public class HomeController {
    private static final Logger LOGGER = LogManager.getLogger(HomeController.class);
    @Autowired
    private UserService userService;

    @Autowired
    private UserConverter userConverter;

    @Autowired
    private ObjectMapper objectMapper;

    @Autowired
    private Scheduler scheduler;

    @Autowired
    private UserRepository userRepository;

    @Autowired
    private ReadFileExcelUtil readFileExcelUtil;

    @GetMapping(value = "/test", produces = MediaType.TEXT_HTML_VALUE)
    @ResponseBody
    public String test(HttpServletRequest request, HttpServletResponse response) throws
            IOException {
//        String text = "0932777157:8587785917563872845,0988212681:8276056227226473658,0944285519:7724062712185366097,0938573367:3640521092488907749,0948300268:2099680296950907459,0903785490:1554754117926943475,0392939123:5437056344945672980,0939008089:5335015048082702185,0908110655:1037239071967942405,0988055823:649786756218450276,0919655686:1498171206085583530,0947742574:7501836495564574587,0919501097:8726552439925120890,0983229484:422216309225956796,0767875377:384943220161785399,0347396903:4252290487312467043,0777050940:1663966636260621431,0913656169:2567661197842939330,0909343222:3241653707098172572,0932946363:2930053345463139785,0919617080:3213929101660867322,0886487868:4251733970988582497,0942713535:7575445122541302849,0917100971:4258348061208043384,0918617141:7924054438375614103,0976929885:6163816974410392554,0916314251:9188031937973846498,0939040406:3987274347424521781,0942495739:4713516541933933577,0919269692:2592993354821018524,0988821340:6781393260956434044,0919321458:4599495108693465012,0907665138:2958915543818978672,0907227157:6555785025940708506,0979862105:4781499934566671675,0919497879:6829098780194793381,0982793858:4153653868042609092,0913793093:4733502991411252688,0939494937:8197364354741653410,0906205900:4830894006335976810,0979858409:3117793064756581156,0961404229:5355849108887594291,0919453952:6011695933000794637,0989208707:1248931060911454261,0907760094:704700682513035943,0817526526:5478846835966752872,0989373344:1028939005697799463,0363891490:1609210726823771957,0907508379:8732900430890677329,0918169989:8172477473071326986,0906634444:265723329733480400,0917186327:1484811439026238459,0983937346:8032281509232667416,0987070713:3822216221241983595,0908884399:5556813517820931197,0886602429:3428259738577354995,0898479770:7629914698711988098,0398581166:2465208024422115414,0948886063:1975682727933447179,0987856040:6362697263592990764,0906991125:1633715940196042444,0917859900:8611440731997276897,0913000484:3818698868797355678,0913968139:6774358106353246563,0907031777:5835496239093929883,0944700600:7343517922395451529,0794444455:7761371126858392277,0966545454:7638224203640215136,0983404049:4871997848186135548,0354206766:1131390981772689619,0357571916:2308145608769033320,0355275273:1247525166124907824,0399074449:8421563229075101631,0976987106:6966200150278090956,0979909094:9151437882827211616,0913735819:2125165453705486110,0939612336:2906267258581221685,0973311152:1460180767103920931,0918813559:7112710804469132245,0945393984:3343398435684824070,0798757799:147643943119123052,0973882949:3570856572816671726,0916688002:2451272661188565604,0858171426:3080526406989452960,0908025956:8140786901971858841,0938107253:8622816657434354122,0987288140:3502290650234836730,0907347769:3565784652881539356,0834513393:6990547110788865635,0783946839:522573912166251296,0386927332:1239057325213638482,0909958634:5473920234074030231,0939855732:3075726868012235215,0913628126:4680728074987784597,0961454568:4378963388780971429,0359827063:3373520419591619505,0907207075:3179723425134506048,0977560731:5346976608003162708,0918049135:998956820943875261,0908414739:1362502415727658632,0907990145:5663382035584396024,0983108739:3113008319190164563,0918186783:4979797537898046075,0946279778:2770608721813580051,0373745130:993608915846904746,0909254112:8671795933917699128,0387656959:1240346507000503126,0947999568:785740276494045575,0906905890:6872168364454935870,0982989230:5558369247787487811,0939790966:4949961988756736465,0976376776:7311433028941737495,0977744784:4260181104534247551,0918119195:4394444102018284700,0907911908:8372600683148491089,0378841474:7526887930406264852,0971835300:6962530142622385151,0919630035:5684603898847318403,0932776632:2905850216380630835,0704889930:7218674748791010637,0977155550:697784314751769295,0369832496:2014950690435633558,0834727332:4184607520031069298,0977688390:4061463544803039549,0933511020:8546422742156054778,0373180477:5050013524911075189,0877703707:9004363550924371349,0913121348:9104708992616519738,0377980978:4266091962982298452,0347927924:4490281035127067184,0919457835:1103816530321089073,0865964707:4146609297546170091,0941234338:1060068312465032406,0907930124:1236130280667826759,0989006049:8377792925729704739,0939309865:4117047378072856386,0919564298:6444178550211169038,0939480070:5650827347774953739,0948662096:8374018094689697366,0378841718:1803294830691181414,0919804412:4228936366022620880,0971706345:5035810419933535106,0369207989:8882902869497954598,0968651247:7650881550221196109,0919764313:5700087716443072890";
//        String[] slips = text.split(",");
//        for (String slip: slips) {
//            String[] strUsers = slip.split(":");
//            String phone = strUsers[0];
//            String zaloId = strUsers[1];
//            try {
//                UserEntity byPhone = userRepository.findByPhone(phone);
//                byPhone.setZaloId(zaloId);
//                userRepository.saveAndFlush(byPhone);
//            }catch (Exception e) {
//                System.out.println(phone);
//            }
//
//        }
        return "OK";
    }

    @GetMapping(value = "/**", produces = MediaType.TEXT_HTML_VALUE)
    @ResponseBody
    public String index(HttpServletRequest request, HttpServletResponse response) throws
            IOException {
        return RenderUtils.render("index.html");
    }


}
